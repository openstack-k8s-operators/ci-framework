---
# SNO minimal resource scenario.
#
# This is a variant of the SNO scenario with reduced resources,
# suitable for development and testing with limited hardware.
# Uses OCP 4.18 SNO minimum requirements.
#
# WARNING: May not be suitable for full OpenStack integration tests.
# Use the standard sno.yml for production testing.
#
# Usage:
#   ansible-playbook reproducer.yml \
#     -e @scenarios/reproducers/sno-minimal.yml \
#     -e @scenarios/reproducers/networking-definition.yml \
#     -e cifmw_manage_secrets_pullsecret_file=/path/to/pull-secret.json \
#     -e cifmw_manage_secrets_citoken_file=/path/to/ci-token
#
# Hypervisor requirements: ~32GB RAM, ~200GB storage

cifmw_parent_scenario: "scenarios/reproducers/sno-common.yml"

# ============================================
# Libvirt configuration for minimal SNO
# ============================================
cifmw_libvirt_manager_configuration:
  networks:
    osp_trunk: |
      <network>
        <name>osp_trunk</name>
        <forward mode='nat'/>
        <bridge name='osp_trunk' stp='on' delay='0'/>
        <dns enable="no"/>
        <ip family='ipv4'
        address='{{ cifmw_networking_definition.networks.ctlplane.network |
                    ansible.utils.nthhost(1) }}'
        prefix='{{ cifmw_networking_definition.networks.ctlplane.network |
                   ansible.utils.ipaddr('prefix') }}'>
        </ip>
      </network>
    ocpbm: |
      <network>
        <name>ocpbm</name>
        <forward mode='nat'/>
        <bridge name='ocpbm' stp='on' delay='0'/>
        <dns enable="no"/>
        <ip family='ipv4' address='192.168.111.1' prefix='24'>
        </ip>
      </network>
    ocppr: |
      <network>
        <name>ocppr</name>
        <forward mode='bridge'/>
        <bridge name='ocppr'/>
      </network>
  vms:
    # SNO with OCP 4.18 minimum requirements
    ocp:
      amount: 1
      admin_user: core
      image_local_dir: "{{ cifmw_basedir }}/images/"
      disk_file_name: "ocp_master"
      disksize: "120"
      extra_disks_num: 1
      extra_disks_size: "30G"
      # OCP 4.18 SNO minimum: 8 vCPU, 16GB RAM, 120GB storage
      cpus: 8
      memory: 16
      root_part_id: 4
      uefi: true
      nets:
        - ocppr
        - ocpbm
        - osp_trunk
        - osp_trunk
    # Minimal compute for basic testing
    compute:
      uefi: "{{ cifmw_use_uefi }}"
      root_part_id: "{{ cifmw_root_partition_id }}"
      amount: 1
      image_url: "{{ cifmw_discovered_image_url }}"
      sha256_image_name: "{{ cifmw_discovered_hash }}"
      image_local_dir: "{{ cifmw_basedir }}/images/"
      disk_file_name: "base-os.qcow2"
      disksize: 30
      memory: 4
      cpus: 2
      nets:
        - ocpbm
        - osp_trunk
    controller:
      uefi: "{{ cifmw_use_uefi }}"
      root_part_id: "{{ cifmw_root_partition_id }}"
      image_url: "{{ cifmw_discovered_image_url }}"
      sha256_image_name: "{{ cifmw_discovered_hash }}"
      image_local_dir: "{{ cifmw_basedir }}/images/"
      disk_file_name: "base-os.qcow2"
      disksize: 30
      memory: 4
      cpus: 2
      nets:
        - ocpbm
        - osp_trunk

# ============================================
# Devscripts configuration for minimal SNO
# ============================================
cifmw_devscripts_config_overrides:
  num_masters: 1
  num_workers: 0
  openshift_version: "stable-4.18"
  openshift_release_type: "ga"
  network_type: "OVNKubernetes"
  fips_mode: "{{ cifmw_fips_enabled | default(false) | bool }}"
