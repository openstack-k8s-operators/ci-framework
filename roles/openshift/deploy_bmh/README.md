# deploy_bmh

This role will creates, and eventually apply, the CR required to
deploy a set of compute nodes using MetalÂ³.

The resulting CR will contain, for each node, the following objects:

* a `Secret` (type `Opaque`) CR with the credentials of the (v)bmc resources
* a `BareMetalHost` CR with the required parameters

## Parameters

* `cifmw_deploy_bmh_basedir`: (*string*) Base directory. Defaults to `cifmw_basedir` which defaults to `~/ci-framework-data`.
* `cifmw_deploy_bmh_parameters_file`:  (*string*) Path of the file which contains (v)bmc parameters. Defaults to `cifmw_deploy_bmh_basedir + /parameters/baremetal-info.yml`
* `cifmw_deploy_bmh_dest_dir`: (*string*) Path of the directory where CRs are generated by the template. Defaults to `cifmw_deploy_bmh_basedir + /artifacts/deploy_bmh`
* `cifmw_deploy_bmh_apply_cr`: (*boolean*) Toggle to enable/disable applying of the generated CR in an OCP cluster. Defaults to `true`
* `cifmw_deploy_bmh_namespace`: (*string*) The namespace where the resources should be created. Defaults to `openshift-machine-api`
* `cifmw_deploy_bmh_boot_interface`: (*string*) The interface used for PXE booting. Defaults to `provision`
* `cifmw_deploy_bmh_disable_certificate_validation`: (*boolean*) Toggle for certificate validation while connecting to the BMC via HTTPS. Defaults to `true`
* `cifmw_deploy_bmh_disable_inspection`: (*boolean*) Disables metal3 introspection of the nodes. Defaults to `true`
* `cifmw_deploy_bmh_patch`: (*dict*) Dictionary to combine with each of generated BMH CRs. Defaults to `{}`
* `cifmw_deploy_bmh_node_patch`: (*dict*) Dictionary with an individual BMH CR patch per node. Defaults to `{}`
* `cifmw_deploy_bmh_patch_secret`: (*dict*) Dictionary to combine with each of generated BMH Secret CRs. Defaults to `{}`
* `cifmw_deploy_bmh_node_patch_secret`: (*dict*) Dictionary with an individual BMH Secret CR patch per node. Defaults to `{}`
* `cifmw_deploy_bmh_patch_nmstate`: (*dict*) Dictionary to combine with each of generated BMH nmstate Secret CRs. Defaults to `{}`
* `cifmw_deploy_bmh_node_patch_nmstate`: (*dict*) Dictionary with an individual BMH nmstate Secret CR patch per node. Defaults to `{}`
* `cifmw_deploy_bmh_root_device_hint_field`: (*string*) The default field to use in the BMH `rootDeviceHints` when a node has `root_device_hint` populated. Defaults to `deviceName`

## Examples

For a comprehensive example, refers to the molecule default scenario provided with this role.

```yaml
- name: Call deploy_bmh role
  hosts: all
  tasks:
    - name: Include deploy_bmh role
      ansible.builtin.include_role:
        name: "deploy_bmh"
```
