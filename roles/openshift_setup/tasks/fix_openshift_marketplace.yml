---
# Note(Chandan): This workaround is taken from
# https://github.com/crc-org/crc/issues/4109#issuecomment-2042497411.
# It will be removed once https://github.com/crc-org/crc/issues/4109
# closed.
- name: Delete the pods from openshift-marketplace namespace
  kubernetes.core.k8s:
    kind: Pod
    state: absent
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    namespace: openshift-marketplace

- name: Wait for openshift-marketplace pods to be running
  kubernetes.core.k8s_info:
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    kind: Pod
    namespace: openshift-marketplace
    wait: true
    wait_condition:
      type: Ready
      status: "True"
    wait_timeout: 300
