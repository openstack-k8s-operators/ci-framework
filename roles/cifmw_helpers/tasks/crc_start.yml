---
- name: Ensure CRC is started
  ansible.builtin.command:
    cmd: >
      crc start {{ cifmw_helpers_crc_additional_params | default('') }}
  register: _crc_output
  ignore_errors: true  # noqa: ignore-errors

- name: Login to the OpenShift when certificate is expired
  when: "'Kubelet serving certificate has expired' in _crc_output.stderr"
  ansible.builtin.command: >
    oc login
    -u kubeadmin
    https://api.crc.testing:6443
    --insecure-skip-tls-verify
  register: _openshift_login
  until: _openshift_login.rc == 0
  retries: 90
  delay: 10
  changed_when: false
