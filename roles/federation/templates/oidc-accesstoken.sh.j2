#!/bin/bash
# OIDC Access Token flow configuration
# This script configures authentication using a pre-obtained access token
# The access token is passed as an argument: source oidc-accesstoken.sh <ACCESS_TOKEN>

ACCESS_TOKEN="$1"

if [ -z "$ACCESS_TOKEN" ]; then
    echo "Usage: source oidc-accesstoken.sh <ACCESS_TOKEN>"
    echo "Error: Access token is required"
    return 1
fi

unset OS_CLOUD
export OS_CACERT=/home/cloud-admin/full-ca-list.crt
export OS_AUTH_URL="{{ cifmw_federation_keystone_url }}/v3"
export OS_IDENTITY_API_VERSION=3
export OS_AUTH_TYPE=v3oidcaccesstoken
export OS_IDENTITY_PROVIDER="{{ cifmw_federation_IdpName }}"
export OS_PROTOCOL=openid
export OS_ACCESS_TOKEN="$ACCESS_TOKEN"
