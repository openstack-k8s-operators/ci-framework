---
- name: Get needed artifacts generated by dev-scripts
  vars:
    _auth_path: >-
      {{
        (
          cifmw_devscripts_repo_dir,
          'ocp',
          cifmw_devscripts_config.cluster_name,
          'auth'
        ) | ansible.builtin.path_join
      }}
  block:
    - name: Slurp devscripts private key
      register: _devscript_privkey
      ansible.builtin.slurp:
        path: >-
          {{
            (cifmw_reproducer_basedir,
            'artifacts',
            'cifmw_ocp_access_key') |
            path_join
          }}

    - name: Slurp content of the devscripts kubeconfig
      register: _devscripts_kubeconfig
      ansible.builtin.slurp:
        path: "{{ (_auth_path, 'kubeconfig') | ansible.builtin.path_join }}"

    - name: Slurp content of the devscripts kubeadmin-password
      register: _devscripts_kubeadm
      ansible.builtin.slurp:
        path: >-
          {{
            (_auth_path, 'kubeadmin-password') | ansible.builtin.path_join
          }}

    - name: Ensure we expose openshift_login related facts
      ansible.builtin.import_role:
        name: devscripts
        tasks_from: set_cluster_fact.yml

    - name: Ensure the OpenShift cluster is stable.
      vars:
        cifmw_openshift_adm_op: "stable"
      ansible.builtin.include_role:
        name: openshift_adm
