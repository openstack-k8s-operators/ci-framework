---
- name: Prepare scripts on controller-0
  delegate_to: controller-0
  block:
    - name: Push script
      vars:
        run_directory: "{{ _cifmw_reproducer_framework_location }}"
        exports:
          ANSIBLE_LOG_PATH: "{{ cifmw_reproducer_controller_user_dir }}/ansible-post-deployment.log"
        default_extravars:
          - "@{{ cifmw_reproducer_controller_basedir }}/parameters/reproducer-variables.yml"
          - "@{{ cifmw_reproducer_controller_basedir }}/parameters/openshift-environment.yml"
        extravars: "{{ cifmw_reproducer_play_extravars }}"
        playbook: "post-deployment.yml"
      ansible.builtin.template:
        dest: "{{ cifmw_reproducer_controller_user_dir }}/post_deployment.sh"
        src: "script.sh.j2"
        mode: "0755"
        owner: "{{ cifmw_reproducer_controller_user }}"
        group: "{{ cifmw_reproducer_controller_user }}"

    - name: Rotate some logs
      tags:
        - always
      ansible.builtin.include_tasks: rotate_log.yml
      loop:
        - ansible-post-deployment.log
