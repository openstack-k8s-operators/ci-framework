---
- name: Prepare scripts on controller-0
  delegate_to: controller-0
  block:
    - name: Push script
      vars:
        run_directory: "{{ _cifmw_reproducer_framework_location }}"
        exports:
          ANSIBLE_LOG_PATH: "{{ cifmw_reproducer_controller_basedir }}/logs/ansible-deploy-architecture.log"
        default_extravars:
          - "@~/ci-framework-data/parameters/reproducer-variables.yml"
          - "@~/ci-framework-data/parameters/openshift-environment.yml"
        extravars: "{{ cifmw_reproducer_play_extravars }}"
        playbook: "deploy-edpm.yml"
      ansible.builtin.template:
        dest: "{{ cifmw_reproducer_controller_user_dir }}/deploy-architecture.sh"
        src: "script.sh.j2"
        mode: "0755"
        owner: "{{ cifmw_reproducer_controller_user }}"
        group: "{{ cifmw_reproducer_controller_user }}"

    - name: Rotate some logs
      tags:
        - always
      ansible.builtin.include_tasks: rotate_log.yml
      loop:
        - ansible-deploy-architecture.log
