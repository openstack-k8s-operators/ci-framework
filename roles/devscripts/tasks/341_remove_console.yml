---
- name: Disable OpenShift Console
  kubernetes.core.k8s:
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    api_key: "{{ cifmw_openshift_token | default(omit) }}"
    context: "{{ cifmw_openshift_context | default(omit) }}"
    definition:
      apiVersion: operator.openshift.io/v1
      kind: Console
      metadata:
        name: cluster
      spec:
        managementState: Removed
    state: present

- name: Scale down console-operator
  kubernetes.core.k8s_scale:
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    api_key: "{{ cifmw_openshift_token | default(omit) }}"
    context: "{{ cifmw_openshift_context | default(omit) }}"
    api_version: apps/v1
    kind: Deployment
    name: console-operator
    namespace: openshift-console-operator
    replicas: 0

- name: Delete console route
  kubernetes.core.k8s:
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    api_key: "{{ cifmw_openshift_token | default(omit) }}"
    context: "{{ cifmw_openshift_context | default(omit) }}"
    state: absent
    api_version: route.openshift.io/v1
    kind: Route
    name: console
    namespace: openshift-console

- name: Delete downloads route
  kubernetes.core.k8s:
    kubeconfig: "{{ cifmw_openshift_kubeconfig }}"
    api_key: "{{ cifmw_openshift_token | default(omit) }}"
    context: "{{ cifmw_openshift_context | default(omit) }}"
    state: absent
    api_version: route.openshift.io/v1
    kind: Route
    name: downloads
    namespace: openshift-console
