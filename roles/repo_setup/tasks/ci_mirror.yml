---
- name: Check for /etc/ci/mirror_info.sh
  ansible.builtin.stat:
    path: "/etc/ci/mirror_info.sh"
  register: mirror_path

- name: Use proxy mirrors
  become: "{{ not cifmw_repo_setup_output.startswith(ansible_user_dir)Â }}"
  when:
    - mirror_path.stat.exists
  ansible.builtin.shell: |
    set -o pipefail
    source /etc/ci/mirror_info.sh
    sed -i -e "s|https://trunk.rdoproject.org|$NODEPOOL_RDO_PROXY|g" *.repo
    {% if ansible_distribution | lower == 'centos' and ansible_distribution_major_version is version('10', '==') %}
    sed -i -e "s|http://mirror.stream.centos.org|$NODEPOOL_CENTOS_MIRROR|g" *.repo
    {% endif %}
  args:
    chdir: "{{ cifmw_repo_setup_output }}"
