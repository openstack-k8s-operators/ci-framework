---
- name: Create group vars dir
  ansible.builtin.file:
    path: "{{ ci_framework_group_vars_path }}"
    state: directory

- name: Check if extra vars
  ansible.builtin.stat:
    path: "{{ item | replace('@', ci_framework_dir + '/') }}"
  register: _extra_vars_stat

#### WORKAROUND FOR loop and include job and temp variable name overwrite
#### issue
##- name: Include extra vars
##  when: _extra_vars_stat.stat.exists
##  ansible.builtin.include_vars:
##    file: "{{ item | replace('@', ci_framework_dir + '/') }}"
##    name: _temp_vars
##
##- name: Append _temp_vars to group_vars all file
##  when: _temp_vars
##  ansible.builtin.blockinfile:
##    path: "{{ ci_framework_group_vars_path }}/all"
##    block: "{{ _temp_vars | to_nice_yaml }}"
##    create: true

- name: Add all variables to a group file
  ansible.builtin.shell: |
    cat "{{ item | replace('@', ci_framework_dir + '/') }}" | sed 's/---//g' >> "{{ ci_framework_group_vars_path }}/all"
