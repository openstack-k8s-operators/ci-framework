---
- job:
    name: podified-multinode-edpm-deployment-crc-3comp
    parent: podified-multinode-edpm-deployment-crc
    nodeset:
      nodes:
        - name: controller
          label: cloud-centos-9-stream-tripleo-vexxhost-medium
        - name: compute-0
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-1
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-2
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: crc
          label: coreos-crc-extracted-2-19-0-xxl
      groups:
        - name: computes
          nodes:
            - compute-0
            - compute-1
            - compute-2
    vars:
      crc_ci_bootstrap_cloud_name: "{{ nodepool.cloud | replace('-nodepool-tripleo','') }}"
      crc_ci_bootstrap_networking:
        networks:
          default:
            mtu: "{{ ('ibm' in nodepool.cloud) | ternary('1440', '1500') }}"
            router_net: "{{ ('ibm' in nodepool.cloud) | ternary('hostonly', 'public') }}"
            range: 192.168.122.0/24
          internal-api:
            vlan: 20
            range: 172.17.0.0/24
          storage:
            vlan: 21
            range: 172.18.0.0/24
          tenant:
            vlan: 22
            range: 172.19.0.0/24
        instances:
          controller:
            networks:
              default:
                ip: 192.168.122.11
          crc:
            networks:
              default:
                ip: 192.168.122.10
              internal-api:
                ip: 172.17.0.5
              storage:
                ip: 172.18.0.5
              tenant:
                ip: 172.19.0.5
          compute-0:
            networks:
              default:
                ip: 192.168.122.100
              internal-api:
                ip: 172.17.0.100
                config_nm: false
              storage:
                ip: 172.18.0.100
                config_nm: false
              tenant:
                ip: 172.19.0.100
                config_nm: false
          compute-1:
            networks:
              default:
                ip: 192.168.122.101
              internal-api:
                ip: 172.17.0.101
                config_nm: false
              storage:
                ip: 172.18.0.101
                config_nm: false
              tenant:
                ip: 172.19.0.101
                config_nm: false
          compute-2:
            networks:
              default:
                ip: 192.168.122.102
              internal-api:
                ip: 172.17.0.102
                config_nm: false
              storage:
                ip: 172.18.0.102
                config_nm: false
              tenant:
                ip: 172.19.0.102
                config_nm: false

- job:
    name: podified-multinode-hci-deployment-crc-3comp
    parent: podified-multinode-edpm-deployment-crc
    nodeset:
      nodes:
        - name: controller
          label: cloud-centos-9-stream-tripleo-vexxhost-medium
        - name: compute-0
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-1
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-2
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: crc
          label: coreos-crc-extracted-2-19-0-xxl
      groups:
        - name: computes
          nodes:
            - compute-0
            - compute-1
            - compute-2
        - name: edpm
          nodes:
            - compute-0
            - compute-1
            - compute-2
    vars:
      cifmw_edpm_deploy_hci: true
      crc_ci_bootstrap_cloud_name: "{{ nodepool.cloud | replace('-nodepool-tripleo','') }}"
      crc_ci_bootstrap_networking:
        networks:
          default:
            mtu: "{{ ('ibm' in nodepool.cloud) | ternary('1440', '1500') }}"
            router_net: "{{ ('ibm' in nodepool.cloud) | ternary('hostonly', 'public') }}"
            range: 192.168.122.0/24
          internal-api:
            vlan: 20
            range: 172.17.0.0/24
          storage:
            vlan: 21
            range: 172.18.0.0/24
          tenant:
            vlan: 22
            range: 172.19.0.0/24
          storage-mgmt:
            vlan: 23
            range: 172.20.0.0/24
        instances:
          controller:
            networks:
              default:
                ip: 192.168.122.11
          crc:
            networks:
              default:
                ip: 192.168.122.10
              internal-api:
                ip: 172.17.0.5
              storage:
                ip: 172.18.0.5
              tenant:
                ip: 172.19.0.5
              storage-mgmt:
                ip: 172.20.0.5
          compute-0:
            networks:
              default:
                ip: 192.168.122.100
              internal-api:
                ip: 172.17.0.100
                config_nm: false
              storage:
                ip: 172.18.0.100
                config_nm: false
              tenant:
                ip: 172.19.0.100
                config_nm: false
              storage-mgmt:
                ip: 172.20.0.100
                config_nm: false
          compute-1:
            networks:
              default:
                ip: 192.168.122.101
              internal-api:
                ip: 172.17.0.101
                config_nm: false
              storage:
                ip: 172.18.0.101
                config_nm: false
              tenant:
                ip: 172.19.0.101
                config_nm: false
              storage-mgmt:
                ip: 172.20.0.101
                config_nm: false
          compute-2:
            networks:
              default:
                ip: 192.168.122.102
              internal-api:
                ip: 172.17.0.102
                config_nm: false
              storage:
                ip: 172.18.0.102
                config_nm: false
              tenant:
                ip: 172.19.0.102
                config_nm: false
              storage-mgmt:
                ip: 172.20.0.102
                config_nm: false

- job:
    name: podified-multinode-edpm-deployment-crc
    parent: cifmw-podified-multinode-edpm-base-crc
    vars:
      cifmw_extras:
        - '@scenarios/centos-9/multinode-ci.yml'
    run:
      - ci/playbooks/edpm/run.yml

- job:
    name: podified-multinode-edpm-ironic-nobuild-tagged-crc
    parent: cifmw-podified-multinode-edpm-base-crc
    nodeset:
      nodes:
        - name: controller
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-0
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: crc
          label: coreos-crc-extracted-2-19-0-3xl
      groups:
        - name: computes
          nodes:
            - compute-0
    vars:
      cifmw_extras:
        - '@scenarios/centos-9/ci.yml'
        - '@scenarios/centos-9/multinode-ci.yml'
        - '@scenarios/centos-9/ironic.yml'
    run:
      - ci/playbooks/e2e-run.yml
    irrelevant-files:
      - ^roles/.*_build
      - ^roles/build.*
      - ^roles/local_env_vm
      - ^ci/templates
      - ^docs
      - ^.*/*.md
      - ^OWNERS
      - ^.github

- job:
    name: podified-multinode-hci-deployment-crc
    parent: podified-multinode-hci-deployment-crc-3comp
    files:
      - ^playbooks/06-deploy-edpm.yml
      - ^playbooks/ceph.yml
      - ^roles/edpm_deploy/(?!meta|README).*
      - ^roles/hci_prepare/(?!meta|README).*
      - ^roles/cifmw_ceph.*/(?!meta|README).*
      - ^roles/cifmw_block_device/(?!meta|README).*
      - ^roles/cifmw_create_admin/(?!meta|README).*

- job:
    name: podified-multinode-edpm-e2e-nobuild-tagged-crc
    parent: cifmw-podified-multinode-edpm-base-crc
    nodeset:
      nodes:
        - name: controller
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: compute-0
          label: cloud-centos-9-stream-tripleo-vexxhost
        - name: crc
          label: coreos-crc-extracted-2-19-0-3xl
      groups:
        - name: computes
          nodes:
            - compute-0
    vars:
      cifmw_extras:
        - '@scenarios/centos-9/ci.yml'
        - '@scenarios/centos-9/multinode-ci.yml'
        - '@scenarios/centos-9/ceph_backends.yml'
    run:
      - ci/playbooks/e2e-run.yml
    irrelevant-files:
      - ^roles/.*_build
      - ^roles/build.*
      - ^ci/templates
      - ^docs
      - ^.*/*.md
      - ^OWNERS
      - ^.github

#
# Jobs using ci-bootstrap layout
#
- job:
    name: podified-multinode-edpm-deployment-crc-bootstrap
    parent: cifmw-podified-multinode-edpm-ci-bootstrap
    extra-vars: &edpm_bootstrap_extra_vars
      # TODO: to be removed after removing its dependency in ci-bootstrap
      crc_ci_bootstrap_networking: {}
    vars: &edpm_bootstrap_vars
      cifmw_networking_definition:
        networks:
          default:
            network: "192.168.122.0/24"
            gateway: "192.168.122.1"
            mtu: 1500
          internal-api:
            network: "172.17.0.0/24"
            gateway: "172.17.0.1"
            vlan: 20
          storage:
            network: "172.18.0.0/24"
            gateway: "172.18.0.1"
            vlan: 21
          tenant:
            network: "172.19.0.0/24"
            gateway: "172.19.0.1"
            vlan: 22
        instances:
          controller:
            networks:
              default:
                ip: "192.168.122.11"
          crc:
            networks:
              default:
                ip: "192.168.122.10"
              internal-api:
                ip: "172.17.0.5"
              storage:
                ip: "172.18.0.5"
              tenant:
                ip: "172.19.0.5"
          compute-0:
            skip-nm-configuration: true
            networks:
              default:
                ip: "192.168.122.100"
              internal-api:
                ip: "172.17.0.100"
              storage:
                ip: "172.18.0.100"
              tenant:
                ip: "172.19.0.100"
      cifmw_extras:
        - '@scenarios/centos-9/multinode-ci.yml'
    run:
      - ci/playbooks/edpm/run.yml

# Job with ci-bootstrap staging branch job - to be used to test ci-bootstrap
- job:
    name: podified-multinode-edpm-deployment-crc-bootstrap-staging
    parent: cifmw-podified-multinode-edpm-ci-bootstrap-staging
    extra-vars: *edpm_bootstrap_extra_vars
    vars: *edpm_bootstrap_vars
    run:
      - ci/playbooks/edpm/run.yml
