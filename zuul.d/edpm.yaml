---
# EDPM job with single node
- job:
    name: cifmw-crc-podified-edpm-deployment
    parent: cifmw-base-crc-openstack
    run: ci/playbooks/edpm/run.yml
    vars:
      cifmw_extras:
        - '@scenarios/centos-9/nested_virt.yml'
    files:
      - '^hooks/playbooks/ceph.yml'

# Virtual Baremetal job with CRC and single compute node.
- job:
    name: cifmw-crc-podified-edpm-baremetal
    nodeset: centos-9-crc-2-48-0-6xlarge
    parent: cifmw-base-crc-openstack
    run: ci/playbooks/edpm_baremetal_deployment/run.yml
    irrelevant-files:
      - ^hooks/playbooks/ironic_.*\.yml$
      - ^\.github/workflows/*
      - ^CONTRIBUTING.md
      - ^docs/*
      - ^OWNERS*
    vars:
      crc_parameters: "--memory 32000 --disk-size 240 --cpus 12"
      cifmw_manage_secrets_pullsecret_content: '{}'
      cifmw_rhol_crc_binary_folder: "/usr/local/bin"

# Virtual Baremetal job with CRC and single bootc compute node.
- job:
    name: cifmw-crc-podified-edpm-baremetal-bootc
    nodeset: centos-9-crc-2-48-0-6xlarge
    parent: cifmw-base-crc-openstack
    run: ci/playbooks/edpm_baremetal_deployment/run.yml
    vars:
      crc_parameters: "--memory 32000 --disk-size 240 --cpus 12"
      cifmw_manage_secrets_pullsecret_content: '{}'
      cifmw_rhol_crc_binary_folder: "/usr/local/bin"
      # This needs to be updated later to not use hardcoded image url but the one pushed by
      # the periodic job for pushing the bootc images to the registry
      cifmw_update_containers_edpm_image_url: quay.io/openstack-k8s-operators/edpm-bootc:latest-qcow2
      cifmw_install_yamls_vars:
        BAREMETAL_OS_IMG: edpm-bootc.qcow2
      cifmw_edpm_deploy_baremetal_bootc: true
      cifmw_update_containers: true

# Virtual Baremetal job with CRC for minor update testing.
# First deploys with pre-update index image (Phase 1), then updates with PR index image (Phase 2).
- job:
    name: cifmw-crc-podified-edpm-baremetal-minor-update
    nodeset: centos-9-crc-2-48-0-6xlarge
    parent: cifmw-base-crc-openstack
    run:
      - ci/playbooks/edpm_baremetal_update/run.yml
      - ci/playbooks/edpm_baremetal_update/update.yml
    dependencies:
      - openstack-k8s-operators-content-provider
    vars:
      crc_parameters: "--memory 32000 --disk-size 240 --cpus 12"
      cifmw_manage_secrets_pullsecret_content: '{}'
      cifmw_rhol_crc_binary_folder: "/usr/local/bin"
      cifmw_minor_update_pre_update_tag: "18.0-fr4-latest"
      cifmw_install_yamls_vars:
        OPENSTACK_CTLPLANE: "config/samples/core_v1beta1_openstackcontrolplane_galera_network_isolation_fr1.yaml"
        BMAAS_INSTANCE_DISK_SIZE: 60

# Podified galera job
- job:
    name: cifmw-crc-podified-galera-deployment
    parent: cifmw-crc-podified-edpm-deployment
    vars:
      cifmw_deploy_edpm: false
      cifmw_use_libvirt: false
      podified_validation: true
      cifmw_run_tests: false

# Install Yamls specific job
- job:
    name: ci-framework-crc-podified-edpm-deployment
    parent: cifmw-crc-podified-edpm-deployment
    files:
      - ^playbooks/*
      - ^roles/edpm_prepare/.*
      - ^roles/edpm_deploy/.*
      - ^roles/artifacts/tasks/edpm.yml
      - ^deploy-edpm.yml
      - ^scenarios/centos-9/edpm_ci.yml

- job:
    name: ci-framework-crc-podified-galera-deployment
    parent: cifmw-crc-podified-galera-deployment
    files:
      - ^playbooks/*
      - ^roles/edpm_prepare/.*
      - ^deploy-edpm.yml
      - ^scenarios/centos-9/edpm_ci.yml

- job:
    name: ci-framework-crc-podified-edpm-baremetal
    parent: cifmw-crc-podified-edpm-baremetal
    files:
      - ^playbooks/*
      - ^roles/edpm_deploy_baremetal/.*
      - ^roles/artifacts/tasks/edpm.yml
      - ^ci/playbooks/edpm_baremetal_deployment/run.yml
      - ^deploy-edpm.yml
      - ^scenarios/centos-9/edpm_baremetal_deployment_ci.yml
