---
# Base job for openstack crc based job
- job:
    name: cifmw-base-crc-openstack
    nodeset: centos-9-crc-xxl
    timeout: 10800
    abstract: true
    parent: base-crc
    required-projects:
      - github.com/openstack-k8s-operators/install_yamls
      - openstack-k8s-operators/openstack-operator
      - name: github.com/openstack-k8s-operators/ci-framework
        override-checkout: main
      - name: github.com/openstack-k8s-operators/repo-setup
        override-checkout: main
    roles:
      - zuul: github.com/openstack-k8s-operators/ci-framework
    vars:
      crc_parameters: "--memory 16000 --disk-size 180 --cpus 6"
      pre_pull_images:
        - registry.redhat.io/rhosp-rhel9/openstack-rabbitmq:17.0

# EDPM job with single node
- job:
    name: cifmw-crc-podified-edpm-deployment
    parent: cifmw-base-crc-openstack
    run:
      - ci/playbooks/e2e-prepare.yml
      - ci/playbooks/dump_zuul_vars.yml
      - ci/playbooks/logs/dstat.yml
      - ci/playbooks/edpm/run.yml
    post-run:
      - ci/playbooks/edpm/post.yml
      - ci/playbooks/collect-logs.yml
    vars:
      network_isolation: true
      crc_attach_default_interface: true

# Install Yamls specific job
- job:
    name: ci-framework-crc-podified-edpm-deployment
    parent: cifmw-crc-podified-edpm-deployment
    files:
      - ^ci_framework/roles/edpm_prepare
      - ^ci_framework/roles/edpm_deploy
      - ^deploy-edpm.yml
    vars:
      cifmw_operator_build_output:
          operators:
              openstack-operator:
                  git_src_dir: /home/zuul-worker/src/github.com/openstack-k8s-operators/openstack-operator
                  image: quay.io/openstack-k8s-operators/openstack-operator-index:latest
