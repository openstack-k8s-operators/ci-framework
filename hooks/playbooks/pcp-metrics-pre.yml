---
#
# Playbook that setups the Performance Co-Pilot toolkit on infra.
# Relies on the corresponding `pcp_metrics` Ansible role.
#
# The best place to call this hook is under post_infra actions.
#
- name: Patch CoreOS
  hosts: crc,ocps,ocp_workers
  gather_facts: false
  tasks:
    - name: Patch CoreOS
      ansible.builtin.include_role:
        name: pcp_metrics
        tasks_from: coreos

- name: Setup PCP repositories for network nodes
  hosts: leafs,spines,routers
  gather_facts: false
  tasks:
    - name: Setup repositories for PCP
      ansible.builtin.include_role:
        name: pcp_metrics
        tasks_from: repo

- name: Start collecting performance metrics
  hosts: all,!localhost
  gather_facts: false
  tasks:
    - name: Setup PCP
      ansible.builtin.include_role:
        name: pcp_metrics
        tasks_from: setup
