---
- name: Configure OSP 17.1 for OIDC federation (render env + Keystone setup)
  hosts: "{{ cifmw_target_host | default('localhost') }}"
  gather_facts: true
  vars:
    _cloud_name: "{{ cifmw_adoption_osp_deploy_scenario.stacks[0].stackname | default('overcloud') }}"
  tasks:
    - name: Set urls for install type uni
      ansible.builtin.set_fact:
        cifmw_federation_keycloak_url: 'https://keycloak-openstack.apps.ocp.openstack.lab'
      when: cifmw_federation_deploy_type == "uni"

    - name: Set urls for install type crc
      ansible.builtin.set_fact:
        cifmw_federation_keycloak_url: 'https://keycloak-openstack.apps-crc.testing'
      when: cifmw_federation_deploy_type == "crc"

    - name: OSP 17.1 OIDC setup via federation role
      ansible.builtin.import_role:
        name: federation
        tasks_from: run_osp17_oidc_setup.yml
