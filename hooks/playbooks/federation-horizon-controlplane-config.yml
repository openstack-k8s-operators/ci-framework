---
- name: Create kustomization to update Horizon to use Federation
  hosts: "{{ cifmw_target_hook_host | default('localhost') }}"
  tasks:
    - name: Read uni vars from federation role
      ansible.builtin.set_fact:
        cifmw_federation_domain: "apps.ocp.openstack.lab"
      when: cifmw_federation_deploy_type == "uni"

    - name: Read crc vars from federation role
      ansible.builtin.set_fact:
        cifmw_federation_domain: "apps-crc.testing"
      when: cifmw_federation_deploy_type == "crc"

    - name: Run SSO MultiRealm controlplane setup
      ansible.builtin.import_role:
        name: federation
        tasks_from: hook_horizon_controlplane_config.yml
