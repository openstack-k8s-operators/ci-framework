---
- name: "Run ci/playbooks/test-base-job/nested-run.yml"
  hosts: "{{ cifmw_target_host | default('localhost') }}"
  gather_facts: true
  tasks:
    - name: Test include a dummy role
      ansible.builtin.include_role:
        name: cifmw_test_role

    - name: Ensure needed directories
      ansible.builtin.file:
        path: "/tmp/{{ item }}"
        state: directory
      loop:
        - artifacts
        - logs

    - name: Run a cifmw plugin
      ci_script:
        output_dir: /tmp/artifacts
        script: |
          echo "Testing action plugin"
      ignore_errors: true
