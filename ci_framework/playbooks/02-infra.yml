- name: Run pre_infra hooks
  vars:
    hooks: "{{ pre_infra | default([]) }}"
  ansible.builtin.import_playbook: ./hooks.yml

- hosts: "{{ cifmw_target_host | default('localhost') }}"
  gather_facts: false
  tasks:
    - name: Ensure libvirt is present/configured
      when:
        - cifmw_use_libvirt is defined
        - cifmw_use_libvirt | bool
      ansible.builtin.include_role:
        name: libvirt_manager
    - name: Prepare CRC
      when:
        - cifmw_use_crc is defined
        - cifmw_use_crc | bool
      ansible.builtin.include_role:
        name: rhol_crc
    - name: Prepare container package builder
      ansible.builtin.include_role:
        name: pkg_build

- name: Run post_infra hooks
  vars:
    hooks: "{{ post_infra | default([]) }}"
  ansible.builtin.import_playbook: ./hooks.yml
